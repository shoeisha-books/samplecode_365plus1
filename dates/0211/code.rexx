/* 測量士の公式（Shoelace）で多角形の面積を求める
     座標は配列 x.i, y.i に順に格納（i=1..n）
     最後は始点に戻さなくてOK。反時計回りで正の値。
     Σ(x_i*y_{i+1} − y_i*x_{i+1}) の絶対値を 2 で割ると面積。
     小数点を含む座標も計算可能。
     可視化: 各辺のクロス積の項を逐次表示する。 */

numeric digits 20                      /* 小数の桁を十分に確保 */
n = 4                                   /* 頂点数 */

x.1 = 0.0; y.1 = 0.0                    /* 頂点1 */
x.2 = 3.0; y.2 = 0.0                    /* 頂点2 */
x.3 = 3.0; y.3 = 2.0                    /* 頂点3 */
x.4 = 0.0; y.4 = 2.0                    /* 頂点4 */

s = 0                                   /* 累積用 */
do i = 1 to n                           /* 頂点を順に処理 */
    /* i=始点, j=次の頂点（最後なら1に戻す） */
    j = i + 1; if j > n then j = 1
    t = x.i * y.j - y.i * x.j             /* クロス積の項 */
    s = s + t                             /* 累積 */
    say i||": "||x.i||"*"||y.j||" - "||y.i||"*"||x.j||" = "||format(t,,6)
end

/* 面積を正の値に揃える（向きに依存しない） */
if s < 0 then s = -s
say "area = "||format(s / 2,, 6)        /* 面積（小数6桁）を表示 */
